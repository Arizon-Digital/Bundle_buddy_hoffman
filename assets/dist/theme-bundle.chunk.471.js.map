{"version":3,"file":"theme-bundle.chunk.471.js","mappings":"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","sources":["webpack://bigcommerce-cornerstone/./assets/js/theme/search.js"],"sourcesContent":["import { hooks } from '@bigcommerce/stencil-utils';\nimport CatalogPage from './catalog';\nimport FacetedSearch from './common/faceted-search';\nimport { announceInputErrorMessage } from './common/utils/form-utils';\nimport compareProducts from './global/compare-products';\nimport urlUtils from './common/utils/url-utils';\nimport Url from 'url';\nimport collapsibleFactory from './common/collapsible';\nimport 'jstree';\nimport nod from './common/nod';\nimport productDisplayMode from './halothemes/haloProductDisplayMode';\nimport haloStickyToolbar from './halothemes/haloStickyToolbar';\n\nconst leftArrowKey = 37;\nconst rightArrowKey = 39;\n\nexport default class Search extends CatalogPage {\n    formatCategoryTreeForJSTree(node) {\n        const nodeData = {\n            text: node.data,\n            id: node.metadata.id,\n            state: {\n                selected: node.selected,\n            },\n        };\n\n        if (node.state) {\n            nodeData.state.opened = node.state === 'open';\n            nodeData.children = true;\n        }\n\n        if (node.children) {\n            nodeData.children = [];\n            node.children.forEach((childNode) => {\n                nodeData.children.push(this.formatCategoryTreeForJSTree(childNode));\n            });\n        }\n\n        return nodeData;\n    }\n\n    showProducts(navigate = true) {\n        this.$productListingContainer.removeClass('u-hidden');\n        this.$facetedSearchContainer.removeClass('u-hidden');\n        this.$contentResultsContainer.addClass('u-hidden');\n\n        $('[data-content-results-toggle]').removeClass('navBar-action-color--active');\n        $('[data-content-results-toggle]').addClass('navBar-action');\n\n        $('[data-product-results-toggle]').removeClass('navBar-action');\n        $('[data-product-results-toggle]').addClass('navBar-action-color--active');\n\n        this.activateTab($('[data-product-results-toggle]'));\n\n        if (!navigate) {\n            return;\n        }\n\n        const searchData = $('#search-results-product-count span').data();\n        const url = (searchData.count > 0) ? searchData.url : urlUtils.replaceParams(searchData.url, {\n            page: 1,\n        });\n\n        urlUtils.goToUrl(url);\n    }\n\n    showContent(navigate = true) {\n        this.$contentResultsContainer.removeClass('u-hidden');\n        this.$productListingContainer.addClass('u-hidden');\n        this.$facetedSearchContainer.addClass('u-hidden');\n\n        $('[data-product-results-toggle]').removeClass('navBar-action-color--active');\n        $('[data-product-results-toggle]').addClass('navBar-action');\n\n        $('[data-content-results-toggle]').removeClass('navBar-action');\n        $('[data-content-results-toggle]').addClass('navBar-action-color--active');\n\n        this.activateTab($('[data-content-results-toggle]'));\n\n        if (!navigate) {\n            return;\n        }\n\n        const searchData = $('#search-results-content-count span').data();\n        const url = (searchData.count > 0) ? searchData.url : urlUtils.replaceParams(searchData.url, {\n            page: 1,\n        });\n\n        urlUtils.goToUrl(url);\n    }\n\n    activateTab($tabToActivate) {\n        const $tabsCollection = $('[data-search-page-tabs]').find('[role=\"tab\"]');\n\n        $tabsCollection.each((idx, tab) => {\n            const $tab = $(tab);\n\n            if ($tab.is($tabToActivate)) {\n                $tab.removeAttr('tabindex');\n                $tab.attr('aria-selected', true);\n                return;\n            }\n\n            $tab.attr('tabindex', '-1');\n            $tab.attr('aria-selected', false);\n        });\n    }\n\n    onTabChangeWithArrows(event) {\n        const eventKey = event.which;\n        const isLeftOrRightArrowKeydown = eventKey === leftArrowKey\n            || eventKey === rightArrowKey;\n        if (!isLeftOrRightArrowKeydown) return;\n\n        const $tabsCollection = $('[data-search-page-tabs]').find('[role=\"tab\"]');\n\n        const isActiveElementNotTab = $tabsCollection.index($(document.activeElement)) === -1;\n        if (isActiveElementNotTab) return;\n\n        const $activeTab = $(`#${document.activeElement.id}`);\n        const activeTabIdx = $tabsCollection.index($activeTab);\n        const lastTabIdx = $tabsCollection.length - 1;\n\n        let nextTabIdx;\n        switch (eventKey) {\n        case leftArrowKey:\n            nextTabIdx = activeTabIdx === 0 ? lastTabIdx : activeTabIdx - 1;\n            break;\n        case rightArrowKey:\n            nextTabIdx = activeTabIdx === lastTabIdx ? 0 : activeTabIdx + 1;\n            break;\n        default: break;\n        }\n\n        $($tabsCollection.get(nextTabIdx)).focus().trigger('click');\n    }\n\n    onReady() {\n        compareProducts(this.context.urls);\n        this.arrangeFocusOnSortBy();\n\n        const $searchForm = $('[data-advanced-search-form]');\n        const $categoryTreeContainer = $searchForm.find('[data-search-category-tree]');\n        const url = Url.parse(window.location.href, true);\n        const treeData = [];\n        this.$productListingContainer = $('#product-listing-container');\n        this.$facetedSearchContainer = $('#faceted-search-container');\n        this.$contentResultsContainer = $('#search-results-content');\n\n        // Init faceted search\n        if ($('#facetedSearch').length > 0) {\n            this.initFacetedSearch();\n        } else {\n            this.onSortBySubmit = this.onSortBySubmit.bind(this);\n            hooks.on('sortBy-submitted', this.onSortBySubmit);\n        }\n\n        // Init collapsibles\n        collapsibleFactory();\n\n        $('[data-product-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showProducts();\n        });\n\n        $('[data-content-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showContent();\n        });\n\n        $('[data-search-page-tabs]').on('keyup', this.onTabChangeWithArrows);\n\n        if (this.$productListingContainer.find('li.product').length === 0 || url.query.section === 'content') {\n            this.showContent(false);\n        } else {\n            this.showProducts(false);\n        }\n\n        const validator = this.initValidation($searchForm)\n            .bindValidation($searchForm.find('#search_query_adv'));\n\n        this.context.categoryTree.forEach((node) => {\n            treeData.push(this.formatCategoryTreeForJSTree(node));\n        });\n\n        this.categoryTreeData = treeData;\n        this.createCategoryTree($categoryTreeContainer);\n\n        $searchForm.on('submit', event => {\n            const selectedCategoryIds = $categoryTreeContainer.jstree().get_selected();\n\n            if (!validator.check()) {\n                return event.preventDefault();\n            }\n\n            $searchForm.find('input[name=\"category\\[\\]\"]').remove();\n\n            for (const categoryId of selectedCategoryIds) {\n                const input = $('<input>', {\n                    type: 'hidden',\n                    name: 'category[]',\n                    value: categoryId,\n                });\n\n                $searchForm.append(input);\n            }\n        });\n\n        setTimeout(() => {\n            $('[data-search-aria-message]').removeClass('u-hidden');\n        }, 100);\n\n        /* Halothemes */\n        this.category_sidebar();\n        productDisplayMode(this.context);\n        haloStickyToolbar();\n        this.showProductsPerPage();\n        if (this.context.themeSettings.halo_show_more == true) {\n            this.showmore_product();\n        }\n    }\n\n    loadTreeNodes(node, cb) {\n        $.ajax({\n            url: '/remote/v1/category-tree',\n            data: {\n                selectedCategoryId: node.id,\n                prefix: 'category',\n            },\n            headers: {\n                'x-xsrf-token': window.BCData && window.BCData.csrf_token ? window.BCData.csrf_token : '',\n            },\n        }).done(data => {\n            const formattedResults = [];\n\n            data.forEach((dataNode) => {\n                formattedResults.push(this.formatCategoryTreeForJSTree(dataNode));\n            });\n\n            cb(formattedResults);\n        });\n    }\n\n    createCategoryTree($container) {\n        const treeOptions = {\n            core: {\n                data: (node, cb) => {\n                    // Root node\n                    if (node.id === '#') {\n                        cb(this.categoryTreeData);\n                    } else {\n                        // Lazy loaded children\n                        this.loadTreeNodes(node, cb);\n                    }\n                },\n                themes: {\n                    icons: true,\n                },\n            },\n            checkbox: {\n                three_state: false,\n            },\n            plugins: [\n                'checkbox',\n            ],\n        };\n\n        $container.jstree(treeOptions);\n    }\n\n    initFacetedSearch() {\n        // eslint-disable-next-line object-curly-newline\n        const { onMinPriceError, onMaxPriceError, minPriceNotEntered, maxPriceNotEntered, onInvalidPrice } = this.context;\n        const $productListingContainer = $('#product-listing-container');\n        const $contentListingContainer = $('#search-results-content');\n        const $facetedSearchContainer = $('#faceted-search-container');\n        const $searchHeading = $('#search-results-heading');\n        const $searchCount = $('#search-results-product-count');\n        const $contentCount = $('#search-results-content-count');\n        const productsPerPage = this.context.searchProductsPerPage;\n        const requestOptions = {\n            template: {\n                productListing: 'search/product-listing',\n                contentListing: 'search/content-listing',\n                sidebar: 'search/sidebar',\n                heading: 'search/heading',\n                productCount: 'search/product-count',\n                contentCount: 'search/content-count',\n            },\n            config: {\n                product_results: {\n                    limit: productsPerPage,\n                },\n            },\n            showMore: 'search/show-more',\n        };\n\n        this.facetedSearch = new FacetedSearch(requestOptions, (content) => {\n            $searchHeading.html(content.heading);\n\n            const url = Url.parse(window.location.href, true);\n            if (url.query.section === 'content') {\n                $contentListingContainer.html(content.contentListing);\n                $contentCount.html(content.contentCount);\n                this.showContent(false);\n            } else {\n                $productListingContainer.html(content.productListing);\n                $facetedSearchContainer.html(content.sidebar);\n                $searchCount.html(content.productCount);\n                this.showProducts(false);\n            }\n\n            $('body').triggerHandler('compareReset');\n\n            $('html, body').animate({\n                scrollTop: 0,\n            }, 100);\n\n            /* Halothemes */\n            this.category_sidebar();\n            productDisplayMode(this.context);\n            haloStickyToolbar();\n            this.showProductsPerPage();\n            if (this.context.themeSettings.halo_show_more == true) {\n                this.showmore_product();\n            }\n\n        }, {\n            validationErrorMessages: {\n                onMinPriceError,\n                onMaxPriceError,\n                minPriceNotEntered,\n                maxPriceNotEntered,\n                onInvalidPrice,\n            },\n        });\n    }\n\n    initValidation($form) {\n        this.$form = $form;\n        this.validator = nod({\n            submit: $form,\n            tap: announceInputErrorMessage,\n        });\n\n        return this;\n    }\n\n    bindValidation($element) {\n        if (this.validator) {\n            this.validator.add({\n                selector: $element,\n                validate: 'presence',\n                errorMessage: $element.data('errorMessage'),\n            });\n        }\n\n        return this;\n    }\n\n    check() {\n        if (this.validator) {\n            this.validator.performCheck();\n            return this.validator.areAll('valid');\n        }\n\n        return false;\n    }\n\n    /* Halothemes Functions */\n\n    category_sidebar() {\n        if ($('.all-categories-list').length > 0) {\n            $('ul.all-categories-list li').each(function() {\n              const breadLink = $('.page-type-product #breadcrumbs-wrapper ul li.breadcrumb.is-active').prev('.breadcrumb').children('a').attr('href');\n              if (($(this).children('a').attr('href') == window.location) || ($(this).children('a').attr('href') == window.location.pathname)) {\n                 $(this).addClass('current-cat');\n                 $(this).children('.dropdown-category-list').addClass('cat-expanded').siblings('.icon-dropdown').addClass('is-clicked');\n                 $(this).parents('.dropdown-category-list').addClass('cat-expanded').siblings('.icon-dropdown').addClass('is-clicked');\n              }\n              if ($(this).children('a').attr('href') == breadLink) {\n                 $(this).addClass('current-cat');\n                 $(this).parents('.dropdown-category-list').addClass('cat-expanded').siblings('.icon-dropdown').addClass('is-clicked');\n                 \n              }\n           });\n                    \n            $('.all-categories-list .icon-dropdown').on('click', function() {\n                $(this).parent().siblings().removeClass('is-clicked');\n                $(this).parent().siblings().find(\"> .dropdown-category-list\").slideUp( \"slow\" );\n                $(this).parent().siblings().find(\"> .icon-dropdown\").removeClass('is-clicked');\n                $(this).parent().find(\"> .dropdown-category-list\").slideToggle( \"slow\" );\n                $(this).parent().siblings().removeClass('open');\n                if ($(this).hasClass('is-clicked')) {\n                    $(this).removeClass('is-clicked');\n                    $(this).parent().removeClass('open');\n                } else {\n                    $(this).addClass('is-clicked');\n                    $(this).parent().addClass('open');\n                }\n           });\n        }\n    }\n\n    showProductsPerPage(){\n        try {\n            var url = new URL(window.location.href);\n            var c = url.searchParams.get(\"limit\");\n            if(c != null){\n                var limit = document.querySelectorAll('select#limit option');\n                Array.prototype.forEach.call(limit, function(element) {\n                    if(element.value == c){\n                        element.selected = true;\n                    }\n                });\n            }\n        } catch(e) {}\n    }\n\n    showmore_product() {\n        const context = this.context;\n\n        $('#button-showmore-category').on('click', (event) => {\n            event.preventDefault();\n            var nextPage = $(\".pagination-wrapper .pagination-item--current\").next(),\n                link = nextPage.find(\"a\").attr(\"href\");\n\n            if (link == undefined) {\n                if (!$('#button-showmore-category').hasClass('disable')) {\n                    $('#button-showmore-category').addClass('disable');\n                }\n            } else {\n                $('#button-showmore-category').addClass('loading');\n\n                $.ajax({\n                    type: 'get',\n                    url: link.replace(\"http://\", \"//\"),\n                    context: this.content,\n                    success: function(data) {\n                        if ($(data).find('#product-listing-container .productListing').length > 0) {\n                            $('#product-listing-container .productListing').append($(data).find('#product-listing-container .productListing').children());\n                            $('.pagination-list').html($(data).find(\".pagination-list\").html());\n                            $('#button-showmore-category').removeClass('loading');\n                            nextPage = $(\".pagination-wrapper .pagination-item--current\").next();\n                            \n                            if (Number($(data).find('.pagination-info .end').text()) < Number($(data).find('.pagination-info .total').text())) {\n                                $('.pagination .pagination-info .end').html($(data).find('.pagination-info .end').text());\n                            } else {\n                                $('.pagination .pagination-info .end').html($(data).find('.pagination-info .total').text());\n                            }\n                            if (nextPage.length === 0) {\n                                $('#button-showmore-category').addClass('disable');\n                                $('#button-showmore-category > span').text('No more product');\n                            }\n\n                            var $prodWrapId = $('#product-listing-container .card-variant').attr('id');\n                            //haloColorVariants(context, $prodWrapId);\n                        }\n                    }\n                })\n            }\n        });\n    }\n}\n"],"names":["Search","_CatalogPage","apply","arguments","_proto","prototype","formatCategoryTreeForJSTree","node","_this","nodeData","text","data","id","metadata","state","selected","opened","children","forEach","childNode","push","showProducts","navigate","this","$productListingContainer","removeClass","$facetedSearchContainer","$contentResultsContainer","addClass","$","activateTab","searchData","url","count","urlUtils","replaceParams","page","goToUrl","showContent","$tabToActivate","find","each","idx","tab","$tab","is","removeAttr","attr","onTabChangeWithArrows","event","eventKey","which","$tabsCollection","index","document","activeElement","nextTabIdx","$activeTab","activeTabIdx","lastTabIdx","length","get","focus","trigger","onReady","_this2","compareProducts","context","urls","arrangeFocusOnSortBy","$searchForm","$categoryTreeContainer","Url","window","location","href","treeData","initFacetedSearch","onSortBySubmit","bind","hooks","on","collapsibleFactory","preventDefault","query","section","validator","initValidation","bindValidation","categoryTree","categoryTreeData","createCategoryTree","selectedCategoryIds","jstree","get_selected","check","remove","_step","_iterator","_createForOfIteratorHelperLoose","done","categoryId","value","input","type","name","append","setTimeout","category_sidebar","productDisplayMode","haloStickyToolbar","showProductsPerPage","themeSettings","halo_show_more","showmore_product","loadTreeNodes","cb","_this3","ajax","selectedCategoryId","prefix","headers","BCData","csrf_token","formattedResults","dataNode","$container","_this4","treeOptions","core","themes","icons","checkbox","three_state","plugins","_this5","_this$context","onMinPriceError","onMaxPriceError","minPriceNotEntered","maxPriceNotEntered","onInvalidPrice","$contentListingContainer","$searchHeading","$searchCount","$contentCount","requestOptions","template","productListing","contentListing","sidebar","heading","productCount","contentCount","config","product_results","limit","searchProductsPerPage","showMore","facetedSearch","FacetedSearch","content","html","triggerHandler","animate","scrollTop","validationErrorMessages","$form","nod","submit","tap","announceInputErrorMessage","$element","add","selector","validate","errorMessage","performCheck","areAll","breadLink","prev","pathname","siblings","parents","parent","slideUp","slideToggle","hasClass","c","URL","searchParams","querySelectorAll","Array","call","element","e","_this6","nextPage","next","link","undefined","replace","success","Number","CatalogPage"],"sourceRoot":""}